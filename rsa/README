Demonstration RSA Implementation

Notes: This program does not use ASN.1 DER format to store the keys, so therefore it is not compatible with keys generated by openssl or other programs.

Security professionals: input and commentary on this code is welcomed and encouraged. Iron sharpens iron!

The proponderance of the security in the RSA algorithm is tied up in the quality of the keys. I have given a lot of attention and consideration to how my keys are generated (by rsa-keygen.c). The algorithm, in a nutshell, is as follows:

1) choose random strings of bytes at half the key bit width using cryptographically secure RNG to be P and Q values
2) Set high bit of these strings to place them at the appropriate bit width
3) Set low bit to make them odd. Verify and adjust the values if they are too close in value.
4) check for primality, if they are composite, increment to the next odd number until a prime is found
5) decrement each P and Q by one, check each P and Q to make sure they don't have low prime factors.
6) prepare modulus, which is P * Q
7) prepare Carmichael totient, which is LCM of (P - 1) * (Q - 1)
8) choose e (public expoent) so that it is coprime with the CT, starting at 65537
9) choose d, make sure it isn't too small relative to size of modulus
10) set up dp, dq, and qinv for decryption using Chinese Remainder Theory
11) write out key elements to a file, convert to PEM format if requested

rsa-util contains a fairly straightforward block-by-block encryptor and decryptor. The digital signature portion embeds the hash and relevant information into a single block.

The program will embed the current GMT time stamp into encrypted files and digital signatures, as well as a user-specified latitude and longitude of the position where the file was encrypted or signed.

rsa-util Usage screen:

[ssviatko@catamaran rsa]$ ./rsa-util -?
RSA file encryptor/digital signature utility
by Stephen Sviatko - (C) 2025 Good Neighbors LLC
revision 0.80 alpha - 2025/Nov/15
usage: rsa-util <options>
  -i (--in) <name> specify input file
  -o (--out) <name> specify output file
  -w (--overwrite) force overwrite of existing output file or signature file
  -k (--key) <name> specify full name of key file to use
  -g (--signature) <name> specify signature file
     (--latitude) <value> specify your latitude
     (--longitude) <value> specify your longitude
       latitude and longitude are specified as floating point numbers
       will be rounded to 4 decimal places (accuracy of 11.1 meters/36.4 feet)
     (--threads) <count> specify number of threads to use during decryption process
     (--nochinese) defeat chinese remainder theorem calculations during decryption
     (--pem) save encrypted files and signatures in privacy-enhanced mail format
     (--debug) use debug mode
  -? (--help) this screen
operational modes (select only one)
  -e (--encrypt) encrypt mode
       encrypts in->out with public key
       example: rsa-util -e -i plainfile -o encfile -k key-public.bin
  -d (--decrypt) decrypt mode
       decrypts in->out with private key
       example: rsa-util -d -i encfile -o decfile -k key-private.bin
  -s (--sign) sign mode (SHA2-512)
       computes sha2-512 hash of in, encrypts the hash and writes to signature file
       example: rsa-util -s -i filetosign -g sigfile -k key-private.bin
  -v (--verify) verify mode
       computes sha2-512 hash of in, compares with hash in decrypted signature file
       example: rsa-util -v -i signedfile -g sigfile -k key-public.bin
  -t (--tell) tell about key
       show details about key specified by -k or --key
       example: rsa-util -t -k keyfile.bin

Sample runs (encryption, decryption, signing, verifying):

rsa-util: input file : logtbl.txt
rsa-util: output file: logtbl.enc
rsa-util: key file   : default-public.pem
rsa-util: selected encryption mode.
rsa-util: key mode: privacy-enhanced mail format
rsa-util: selected 4096 bit key.
rsa-util: selecting native binary format for encrypted message.
rsa-util: overwriting existing output file logtbl.enc
rsa-util: encrypting ... done.
rsa-util: completed operation in 0 seconds 630189 usecs.
[ssviatko@catamaran rsa]$ ./rsa-util -d -i logtbl.enc -o logtbl.dec -w -k default-private.pem
rsa-util: input file : logtbl.enc
rsa-util: output file: logtbl.dec
rsa-util: key file   : default-private.pem
rsa-util: selected decryption mode.
rsa-util: enabling 8 threads.
rsa-util: key mode: privacy-enhanced mail format
rsa-util: selected 4096 bit key.
rsa-util: overwriting existing output file logtbl.dec
rsa-util: decryption mode: native binary format
rsa-util: data length in input file is 2009451 bytes.
rsa-util: GMT time stamp: Wed Nov 19 18:51:51 2025
rsa-util: geolocation: latitude 0.0000, longitude 0.0000
rsa-util: decrypting (2009451 of 2009451)
rsa-util: CRC OK
rsa-util: completed operation in 11 seconds 908668 usecs.
[ssviatko@catamaran rsa]$ ./rsa-util -s -i logtbl.txt -g logtbl.sig -w -k default-private.pem --pem
rsa-util: input file : logtbl.txt
rsa-util: key file   : default-private.pem
rsa-util: signature  : logtbl.sig
rsa-util: selected sign mode.
rsa-util: key mode: privacy-enhanced mail format
rsa-util: selected 4096 bit key.
rsa-util: selecting privacy-enhanced mail format for digital signature.
rsa-util: overwriting existing signature file
rsa-util: embedding GMT time stamp: Wed Nov 19 18:52:21 2025
rsa-util: embedding geolocation: latitude 0.0000, longitude 0.0000
rsa-util: converting signature to privacy-enhanced mail format...
rsa-util: writing signature file...
rsa-util: completed operation in 0 seconds 69613 usecs.
[ssviatko@catamaran rsa]$ ./rsa-util -v -i logtbl.txt -g logtbl.sig -w -k default-public.pem
rsa-util: input file : logtbl.txt
rsa-util: key file   : default-public.pem
rsa-util: signature  : logtbl.sig
rsa-util: selected verify mode.
rsa-util: key mode: privacy-enhanced mail format
rsa-util: selected 4096 bit key.
rsa-util: reading privacy-enhanced mail format signature...
rsa-util: verify OK
rsa-util: GMT timestamp of signature: Wed Nov 19 18:52:21 2025
rsa-util: geolocation: latitude 0.0000, longitude 0.0000
rsa-util: completed operation in 0 seconds 34145 usecs.

rsa-keygen Sample key generation:

[ssviatko@catamaran rsa]$ ./rsa-keygen --pem
rsa-keygen: block bit width: 4096
rsa-keygen: enabling 8 threads.
rsa-keygen: searching for key ............................
rsa-keygen: done.
rsa-keygen: found key in 4 seconds 317976 usecs.
rsa-keygen: output mode: privacy-enhanced mail format
rsa-keygen: public key file : default-public.pem
rsa-keygen: private key file: default-private.pem
modulus n (4096 bits):
DA 94 2A D9 88 88 A4 FF 18 F4 61 C7 0B 2E 94 D5 66 19 E4 C1 BB 15 A4 3B CE E3 DC E6 A9 8D AF 19 D2 9D EF 6B 5B 4E 7A 73 BF 87 5A 19 6B DF 19 D6 A9 24 40 84 DB 09 5D 7E F7 D9 9F 71 29 93 D1 FB
44 09 AF AA 6D 7D D9 4F D3 A4 26 F0 60 13 25 E8 5B C2 25 E3 CF E0 0C 24 CC A9 1F 78 15 11 3F 02 19 27 85 0D 27 93 EE 7A D6 B4 5C B0 4C 61 E6 15 FB 39 80 09 4A C9 AE FF B2 40 D5 35 ED 58 FF B4
30 F4 56 13 CF 3F E4 81 04 F8 09 C0 95 B9 AA EC 71 47 45 54 B3 7E CA 22 E0 9E 7F 1B 83 EB A5 D7 99 87 52 87 D1 2D 6C F2 8E 47 07 7F B2 AE 39 A3 AD 84 1B E3 87 EC 77 85 5F C1 38 2B 6F 1B B5 F6
92 9E 17 E6 66 44 82 AF AF 48 81 A8 EA 1B C3 EE F8 EC 3D 52 BB 2F 17 7B 42 15 C9 A8 2D 3B E1 75 87 E9 8F FF 7B 12 67 71 AD 11 30 B0 BA F4 E9 1C 40 80 E4 6B F3 37 94 95 B8 7C BA 4C F8 EE EA 53
D4 8A 7D C6 66 73 03 0C 36 6A 0A 21 68 50 2B 72 CE 1C 0F A4 7A F8 14 41 EC 4B D2 F4 B1 5A BA D2 F7 98 B6 87 F2 5C 5A EB EA 93 CD 92 E9 65 72 60 7D 95 B5 CB 3D B8 F4 55 87 95 2F 66 F6 28 91 60
88 D9 84 D9 7C DE 88 7B 2E 35 BC 82 C9 E3 05 D5 EB A5 B2 35 41 47 95 EE F1 94 24 A3 34 DF 6B 37 0A B7 37 48 A3 CE EE A9 D3 4C 33 8D 65 43 6C 04 04 C9 C6 1E 90 7A F2 B0 95 37 A7 97 9B E9 AB 12
C2 58 75 8D 26 51 D0 99 D4 C2 7E 44 4F F7 DF 9F 14 11 4A 93 C1 1F 58 46 E7 2F E1 16 61 D2 C8 E5 3F 50 41 5D C3 B7 AA 52 AE E2 E4 BD DD D8 5B A3 D1 D2 56 AB C8 BA 6A DD 89 C6 F3 A7 21 A6 2A 7E
19 52 B9 60 1C 08 13 8F B7 E9 45 CE 92 4F 08 99 80 2C 60 97 52 B8 4B 87 06 30 F9 46 A0 53 7F A2 76 A8 F1 CB 14 5D D7 47 8B 45 CB B4 6B 7D F9 56 D5 96 FC 2D A2 DA 78 78 FF 48 D3 BE 67 38 04 A3
public exponent e:
00 01 00 01
private exponent d:
22 3F 59 F1 68 9B A4 62 95 E9 E0 92 1B D5 EA 1A FF 9A EA 05 52 C7 62 CA BE 31 64 B0 BD 7B 46 26 C1 21 DE DC 0E DB DE 82 D9 4D 1F 58 61 56 FD 08 ED CA 90 D3 60 30 78 F6 46 66 52 3D 9C 5A 9D 69
85 B1 10 D5 9E BF 3B B7 EE BC C7 1F 1D A6 92 67 74 4D 18 BB B7 9B EE BB 2B 58 0A 66 B9 C2 50 81 87 28 72 87 EB 9E 19 9D 24 9B F0 F3 EC 9B E0 3D AC 75 C7 72 6D 45 E9 86 05 CB 73 BC B5 DA 1E 82
80 B3 1F F3 8D A3 00 AE 18 75 B6 AD 76 A8 37 38 41 CD 7D 76 F6 82 D4 B0 1F 4A A6 36 CC F6 34 AF 71 CE 4A A7 9E 26 44 6E 42 CD AD 46 9C 5C 01 0A FC CA 78 C6 2F 4B 65 34 C0 1A 99 AE F0 83 42 81
06 5A FF FA A9 26 6D E5 92 0C C5 C8 0E 1A 58 9A 4E 65 51 7C 6F 78 C2 F0 9C 9B A6 53 93 F6 D0 6E 26 63 F9 9C 79 8F 9A 26 AD 0B C6 F9 C1 E9 52 C7 0A F2 47 18 04 ED 3D FA 31 84 55 7A 6E FC 9C 39
49 2D 5E 00 A6 E8 F5 81 03 E8 68 F7 D6 8D DF 27 32 AF FC 8B BD 91 AF 07 FB CC 25 90 CC 30 D4 A0 39 BD 86 4B 07 8D 66 76 48 3C F9 95 23 BE FC 1D 36 52 1B 87 23 0F 60 D4 C4 E4 F6 74 AD D8 9E 50
6B 62 AA 02 61 23 F0 0F 2E 3B A2 D3 AA 1A 61 61 84 61 AF B6 16 30 75 74 F1 95 E6 C3 C7 35 AB BA 67 F4 B5 87 4E 48 4F EF E0 54 6C 1F F3 03 05 CE 58 F7 D8 17 EF 9C E2 63 88 D6 A4 62 26 A1 0A A0
07 DA F4 F5 30 0F C0 DB C9 D1 A5 3D 59 F9 C3 1D 24 D3 4F 16 A1 46 20 F8 32 BA 05 72 41 E2 F1 4E 8B 14 67 9B 99 86 16 F6 2C 25 42 90 42 2B 40 BD E0 42 81 07 BE 85 79 44 33 49 D6 54 37 32 28 E8
97 F6 30 25 A1 6F 7D DA C0 D0 86 91 C4 48 EB D9 24 66 22 02 1B 22 DB 8A 62 94 1C 12 72 5B 84 FE 19 0D 3E CE DF 50 BF 49 C4 28 41 42 5A 8A DB A8 9D 65 39 20 E4 B4 75 15 7D 7C 7C 68 F8 75 BB F5
prime p:
E8 17 D8 B6 42 BB B7 C0 59 8A 12 15 A8 1F E4 3B F2 A6 7D CF 9A 56 14 D8 60 54 B1 AE 7E B4 77 C4 91 05 93 8A 8D C3 A9 EA 12 2D E6 C2 3C 8B 2C 05 28 86 8D 2F 6A 5C DC 96 E3 7E 9A E0 81 64 45 E7
F5 40 8E E6 D6 E6 C9 F1 C3 CE BD 76 EA 67 4B 35 3E 61 95 FE 30 35 F2 B4 C3 A9 68 34 3E 60 97 18 6D 09 19 6C 6A 45 7C 51 05 1D 64 59 81 CE 9C 47 CC C3 3A 11 76 DC F4 E8 C2 01 27 C4 6E BE BC 21
FB 64 79 CD 2B 4E F0 E6 02 D9 2C 94 E0 94 B0 0D 64 DF C0 1A 5A B4 36 7C B2 02 C1 89 11 B6 B0 AA 60 3F FE 8D 7F 2E 5D 9F B6 A8 19 E2 B2 40 1C 9D 37 F7 83 3D CB DA EF 87 26 92 89 D1 4C CF CF 19
E4 A1 5C C8 DA 2B 84 6E E3 A4 1A 12 6E 45 F6 3E 72 75 94 0B BD ED 26 E8 01 12 2F 81 E4 E3 1B 32 25 E6 6C E9 9B 49 09 A9 FB 6C CD 8F 6E 73 05 81 35 C0 02 2B 89 15 05 71 5B 15 0C CD C2 AA F3 0D
prime q:
F1 17 F4 87 65 B4 5D EE BF C8 60 0C DC 0E 47 B6 0E A6 50 CE 8E 00 8E 98 DB 5A 88 20 78 B0 56 A6 7B 12 EE 1F 83 AC 99 21 B0 6D 88 EC 70 91 3B 4B 8D 84 E2 7F 6A 3D 4B 2F 72 45 64 21 A1 12 D2 7E
87 AD B7 D5 06 EA 3D 47 F3 F9 59 96 3D 58 90 95 B0 37 1B 49 2E 66 0C 8C 8F BF 9F 4F 5D 2C 65 A6 6E EE AF F4 09 C7 84 B7 4F 8A 54 AF 34 51 C6 A9 E9 B6 B7 BC 2E C0 15 7A A8 BD 3B 35 63 E9 19 05
88 4A 4F 70 3A 1C B1 04 D0 AA A1 2D 37 97 03 AB 2A 3A 2E 78 24 FE 7D A3 79 1E 82 75 0F 42 9E BE 52 21 CE B6 29 7E 8E 0C 54 AC 8E DC 32 F9 50 D5 E2 F4 4F 6A 75 74 F8 95 A2 97 02 D5 48 44 E8 C1
10 29 96 3C 25 73 38 53 82 47 67 AF 8D EF 9D 3E 17 2B 1A 45 DF 23 34 BE C7 54 72 92 7F AE 62 D3 E9 83 7C 4A 0A 95 F7 52 F5 5A 22 AA 45 BF 65 2E A3 45 91 75 72 40 F5 FA AC FD AA F4 DB FA AA 6F
exponent dp:
1A E7 70 C2 A7 F7 B4 B4 42 6C E3 ED C8 C0 71 A7 95 58 41 6B 48 5B C4 2C D4 F5 DC 66 FA DF 16 A7 1D 9C 84 DE E1 D2 15 A7 41 96 3A 92 B7 8B F6 7D 5E 96 42 55 85 C1 DF FC 49 C0 CA 59 4E 06 7E A8
05 E1 06 EF B1 67 AD 6F 2E 20 90 0B F1 DE 29 74 B1 97 84 58 A3 E4 0D 0F 71 42 F9 06 5D 58 BB 0B 24 D0 92 36 E4 16 CB F3 64 61 64 D9 8F 57 90 FC 2D BB 4F C6 E8 7D 72 92 6C B2 CF 96 50 B4 21 80
DA F0 69 C2 23 CC 11 D6 C7 EB BE E4 3F 28 5D 44 20 36 63 C1 6A 54 4B A0 A6 CD F4 FB 5B A7 4E D1 61 38 E9 DC 23 2B 0F C5 4C DA 2D AD FE B5 B9 DB 6B BA 70 67 40 73 4F A2 DE 10 CC 93 0B 91 67 53
7C 12 4C 7C 27 F6 35 72 D9 46 93 93 21 5F 50 CD 2A 5D 80 DC DF 96 57 15 3B D2 8C D9 44 DC 22 B1 EC 7C CA 91 45 E3 F0 8F D8 CA 63 05 C6 6A E4 EF 76 78 9C 87 C9 6B 3B 67 49 84 A6 28 4F F1 9B 1D
exponent dq:
D1 0D 3F 88 64 05 08 EA 2B BB D8 A5 6D EE A7 F9 D2 2C 1E A7 6C 74 49 31 7C 0A BD 3C C2 C9 CC E8 E0 91 22 8F 8B 02 8F 69 A9 EC E0 AC 7C 53 42 42 19 FD 5E D4 B2 CF 61 31 4B F9 A5 80 8F 85 9D A5
FF 89 FF 7C 25 59 D9 37 59 F3 1D DE 6B 65 2F 41 CC A1 8B F4 61 DA 35 09 70 DF EC 88 C9 B6 E4 91 73 61 5E 8A D2 2C 02 05 5D 60 0A 5C 3D 96 A7 17 D0 43 12 80 87 5D 21 82 D1 6B FC 3A 28 5F 07 C6
47 4E 80 21 45 12 79 E0 3D FB A6 74 69 DE 75 5C E6 E9 BA 3F 8D 7C 6A 7E E4 58 33 30 C3 C1 B5 9A 3B E7 7A B1 73 BB 7B FA 6F 35 8D 4E 9C 98 98 A2 4E 00 20 18 A4 AE 7F 9A 68 78 5F 09 87 77 D1 07
0F 37 B0 40 89 0C A6 8B AA CC B5 B8 80 EF 83 BE 42 22 AA CE 69 54 C2 B8 A6 68 B0 4C 1D 90 9D BB 38 A1 3D 95 8A 26 4D 65 CE BF 90 8D 6A 9B 32 66 45 46 DE 81 23 47 F6 C2 9D 5B FB F0 04 0B 0F DB
coefficient qinv:
A9 73 11 0A E3 8A 1F 17 84 DB FC DA CF 80 81 CF 33 A3 72 88 AA 84 42 17 AD 24 73 AC 88 09 85 92 B5 C1 A3 31 15 DA 04 4B A2 13 FB 1F CD FD 07 BB 8B D5 B7 67 01 7A F8 CA 16 44 97 A6 3A 3B 0C CC
FC 47 E9 42 A6 6E C4 86 03 AD D7 5D 89 E9 49 C6 87 E6 46 5E D8 BF B0 B5 16 40 58 23 29 67 0A 84 E3 E4 6D 18 BF 43 03 44 13 57 96 34 6C 19 5A E3 79 6B DB DA 4B 6D 5A BE 74 0E F3 44 28 16 EB FA
DF 5F 4D CC F6 31 C2 9A 32 FB D0 A7 7C 03 98 8C 24 03 76 F6 A8 AD 0E 1D 98 3A 26 A7 CF 1D 34 39 93 65 42 2E CC A1 64 0E 31 90 57 C3 28 33 D8 DC 7D 51 2A 1F 1E 70 4E 77 87 7B 09 DD E1 49 6A 0A
74 EC BD 73 63 CC DC 8A F0 35 F7 61 1D FF 69 D8 F6 07 EC 19 45 F2 A9 EB F7 DD 46 14 85 96 AB B5 B2 23 72 E8 18 B7 D8 A7 08 90 DB 83 E2 C1 B6 03 37 49 04 DA 66 91 13 6A 8F 78 9E 52 BA AC 6F 1F

